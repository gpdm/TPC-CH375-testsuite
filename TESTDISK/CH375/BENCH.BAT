@ECHO OFF

REM Check if \TEMP\BENCH.RUN checkpoint file exists
REM Assume failure or premature aborting during previous run
REM and skip over the currect benchmark accordingly
IF EXIST \TEMP\BENCH.RUN GOTO DONE

:ENUMDRVS
SET DRIVE=/
REM NOTE: this implementation is broken in DR DOS
REM FOR %%d in (C D E F G H I J K L M N O P Q R S T U V W X Y Z) DO IF EXIST %%d:\NUL SET DRIVE=%%d
REM old school, but portable ...
IF EXIST Z:\NUL SET DRIVE=Z
IF EXIST Y:\NUL SET DRIVE=Y
IF EXIST X:\NUL SET DRIVE=X
IF EXIST Z:\NUL SET DRIVE=Z
IF EXIST V:\NUL SET DRIVE=V
IF EXIST U:\NUL SET DRIVE=U
IF EXIST T:\NUL SET DRIVE=T
IF EXIST S:\NUL SET DRIVE=S
IF EXIST R:\NUL SET DRIVE=R
IF EXIST Q:\NUL SET DRIVE=Q
IF EXIST P:\NUL SET DRIVE=P
IF EXIST O:\NUL SET DRIVE=O
IF EXIST N:\NUL SET DRIVE=M
IF EXIST M:\NUL SET DRIVE=N
IF EXIST L:\NUL SET DRIVE=L
IF EXIST K:\NUL SET DRIVE=K
IF EXIST J:\NUL SET DRIVE=J
IF EXIST I:\NUL SET DRIVE=I
IF EXIST H:\NUL SET DRIVE=H
IF EXIST G:\NUL SET DRIVE=G
IF EXIST F:\NUL SET DRIVE=F
IF EXIST E:\NUL SET DRIVE=E
IF EXIST D:\NUL SET DRIVE=D
IF EXIST C:\NUL SET DRIVE=C
IF NOT "%DRIVE%" == "/" GOTO BENCH

:FAIL
ECHO ERROR: Expecting ISA2USB to be available at C: - Z:
ECHO        No drive found (or inaccessible)
ECHO.
ECHO ABORTING now!
GOTO DONE

:BENCH
ECHO Running DiskTest benchmark for "%1" on drive %DRIVE%: ...
%DRIVE%:
IF NOT ERRORLEVEL == 0 GOTO FAIL
A:\UTIL\DISKTEST

:DONE
A:
IF EXIST \TEMP\BENCH.RUN DEL \TEMP\BENCH.RUN
